<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-11-26 Sun 17:01 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Emacs 的一些技巧</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="ying dai" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
<link href='http://apps.bdimg.com/libs/highlight.js/9.1.0/styles/zenburn.min.css' rel='stylesheet'>
<script src='http://apps.bdimg.com/libs/highlight.js/9.1.0/highlight.min.js'></script>
<script>hljs.initHighlightingOnLoad();</script>
<link rel='stylesheet' href='../css/worg2.css' typbe='text/css'/>
<link rel='shortcut icon' type='image/x-icon' href='/favicon.ico'>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2017 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">

<div class='nav'>
<div class='blog' style='text-align:right'>
<a href='/index.html'> Home </a> | <a href='/contact.html'> About </a>
</div>
</div>
</div>
<div id="content">
<h1 class="title">Emacs 的一些技巧</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb2882ba">1. 设置一个标记(Mark)</a></li>
<li><a href="#orgfb51c85">2. 快速的选中一行</a></li>
<li><a href="#org8999e6e">3. org mode 发布网站的问题</a></li>
<li><a href="#org60dba9e">4. Apropos</a></li>
<li><a href="#org4e6d5fb">5. 跳到本行第一个非空格字符上</a></li>
<li><a href="#org6c7175e">6. 特殊字符与数字键交换</a></li>
<li><a href="#orgc3399f6">7. 在 Emacs 中禁用鼠标</a></li>
<li><a href="#orgee43c5b">8. 交换 C-w 和 M-w 的命令绑定</a></li>
<li><a href="#org6a9e802">9. 截图</a></li>
<li><a href="#orgcc510d5">10. 拖拽图片到 Org mode</a></li>
<li><a href="#orgb59129c">11. Emacs 的键盘宏</a></li>
<li><a href="#orga08fff6">12. new-line-and-indent</a></li>
<li><a href="#org0e32ef9">13. Butterfly</a></li>
<li><a href="#org02672b0">14. 快速生成有序序列</a></li>
<li><a href="#org751ed96">15. C-x r t string-rectangle</a></li>
<li><a href="#org2367969">16. MULTIPLE CURSORS</a></li>
<li><a href="#org497a4ce">17. xah math input (here)</a></li>
<li><a href="#orgb75b417">18. 自动在中英文之间添加空格</a></li>
<li><a href="#org9c2f80d">19. 禁用特定模式下的快捷键绑定</a></li>
<li><a href="#org9186d74">20. &amp;key</a></li>
<li><a href="#org2676647">21. Tramp 的使用</a></li>
<li><a href="#org85555d5">22. Emacs 中行操作</a></li>
<li><a href="#org06808d1">23. Emacs 模糊打开文件</a></li>
<li><a href="#org80c5dd3">24. Emacs Dired mode</a></li>
<li><a href="#orgddbb8f4">25. 定义 toggle/cycle command（参考）</a></li>
<li><a href="#org3a40834">26. Emacs &#x2013;script</a></li>
<li><a href="#orgea87798">27. Install and Update packages</a></li>
<li><a href="#orgf16813a">28. Emacs List 的操作</a></li>
<li><a href="#orgb7747eb">29. Elisp 代码文件分割线</a></li>
<li><a href="#org97b453f">30. 使用 Deft 快速的记笔记</a></li>
<li><a href="#orgbdeb207">31. MULTIPLE CHOICES IN YASNIPPETS</a></li>
<li><a href="#org62570da">32. org-indent-mode</a></li>
</ul>
</div>
</div>
<hr />
<div id="outline-container-orgb2882ba" class="outline-2">
<h2 id="orgb2882ba">1. 设置一个标记(Mark)</h2>
<div class="outline-text-2" id="text-orgb2882ba">
<p>
命令是 <code>set-mark-command</code>, 绑定的快捷键为 C-@, C-., C-SPC，推荐使用 <code>C-.</code> 。 因为 C-SPC 与输入法有冲突，C-@比较难按。
再次按下 <code>C-.</code> 会取消标记。
</p>

<p>
设置矩形区域标记，使用 C-x &lt;spc&gt;, visit <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Rectangles.html">here</a>.
</p>
</div>
</div>

<div id="outline-container-orgfb51c85" class="outline-2">
<h2 id="orgfb51c85">2. 快速的选中一行</h2>
<div class="outline-text-2" id="text-orgfb51c85">
<p>
现在一行的开头设置一个 <code>mark</code> ，然后移动到行尾。即：
</p>
<div class="container">
<pre><code class="shell">C-a C-. C-e
</code></pre>
</div>

<p>
同样的原理，我们可以在任何一个位置设置一个 mark，然后选中其前面或后面的文本。
</p>
</div>
</div>

<div id="outline-container-org8999e6e" class="outline-2">
<h2 id="org8999e6e">3. org mode 发布网站的问题</h2>
<div class="outline-text-2" id="text-org8999e6e">
<p>
在 org 中有时需要写类似这种 <code>A_B</code> 的东西，但是在解释成 html 后就成了下标了。
解决的方法可以写成 <code>#+OPTIONS: ^:nil</code>
</p>

<p>
另外一个问题时，在使用 publish 发布的时候，如何禁用 cache，可以这样：
</p>

<div class="container">
<pre><code class="lisp"><span class="org-rainbow-delimiters-depth-1">(</span>setq org-publish-use-timestamps-flag nil<span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>
</div>
</div>

<div id="outline-container-org60dba9e" class="outline-2">
<h2 id="org60dba9e">4. Apropos</h2>
<div class="outline-text-2" id="text-org60dba9e">
<p>
Finally, there are two powerhouse commands that you’ll want to
turn to when all else fails. For example, when you’re fairly
certain that Emacs has commands for doing something, but aren’t
able to find it using any of the usual methods. Say, you want to
learn how to edit rectangular regions in Emacs, but can’t remember
the commands. That’s where the apropos commands come in. Two
important ones are <code>C-h a</code>, for <code>apropos-command</code>, and <code>C-h d</code>, for
<code>apropos-documentation</code>.
</p>

<p>
For example, pressing <code>C-h a RET rectangle RET</code> will list all
commands containing the string <code>rectangle</code>, along with their key
bindings. Then you can quickly recall that the key binding for
<code>kill-rectangle</code> is <code>C-x r k</code>, and that most of the other rectangle
commands also begin with <code>C-x r</code>. Note that the “pattern” you
provide to these <code>apropos</code> commands can also be a regular
expression.
</p>
</div>
</div>

<div id="outline-container-org4e6d5fb" class="outline-2">
<h2 id="org4e6d5fb">5. 跳到本行第一个非空格字符上</h2>
<div class="outline-text-2" id="text-org4e6d5fb">
<p>
对应的命令是 <code>back-to-indentation</code> ，默认绑定的快捷键是 <code>M-m</code> 。
</p>
</div>
</div>

<div id="outline-container-org6c7175e" class="outline-2">
<h2 id="org6c7175e">6. 特殊字符与数字键交换</h2>
<div class="outline-text-2" id="text-org6c7175e">
<p>
在几乎所有的语言中，我们要输入很多的特殊字符，例如
</p>
<div class="container">
<pre><code class="python">! @ <span class="org-comment-delimiter"># </span><span class="org-comment">$ % ^ &amp; * ( )</span>
</code></pre>
</div>

<p>
但是这种字符的输入有些麻烦，需要按住 shift 键才行，下面我们就优化一下这种操作。
</p>

<div class="container">
<pre><code class="elisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defvar</span> <span class="org-variable-name">*unshifted-special-chars-layout*</span>
  <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"1"</span> <span class="org-string">"!"</span><span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-comment-delimiter">; </span><span class="org-comment">from -&gt; to</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"2"</span> <span class="org-string">"@"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"3"</span> <span class="org-string">"#"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"4"</span> <span class="org-string">"$"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"5"</span> <span class="org-string">"%"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"6"</span> <span class="org-string">"^"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"7"</span> <span class="org-string">"&amp;"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"8"</span> <span class="org-string">"*"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"9"</span> <span class="org-string">"("</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"0"</span> <span class="org-string">")"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"!"</span> <span class="org-string">"1"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"@"</span> <span class="org-string">"2"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"#"</span> <span class="org-string">"3"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"$"</span> <span class="org-string">"4"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"%"</span> <span class="org-string">"5"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"^"</span> <span class="org-string">"6"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"&amp;"</span> <span class="org-string">"7"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"*"</span> <span class="org-string">"8"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">"("</span> <span class="org-string">"9"</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-string">")"</span> <span class="org-string">"0"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">mb-str-to-unibyte-char</span> <span class="org-rainbow-delimiters-depth-2">(</span>s<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Translate first multibyte char in s to internal unibyte representation."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>multibyte-char-to-unibyte <span class="org-rainbow-delimiters-depth-3">(</span>string-to-char s<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">remap-keyboard</span> <span class="org-rainbow-delimiters-depth-2">(</span>mapping<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"Setup keyboard translate table using a list of pairwise key-mappings."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>mapcar
   <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-4">(</span>mb-string-pair<span class="org-rainbow-delimiters-depth-4">)</span>
     <span class="org-rainbow-delimiters-depth-4">(</span>apply <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">keyboard-translate</span>
        <span class="org-rainbow-delimiters-depth-5">(</span>mapcar <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">mb-str-to-unibyte-char</span> mb-string-pair<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
   mapping<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span>remap-keyboard *unshifted-special-chars-layout*<span class="org-rainbow-delimiters-depth-1">)</span>

</code></pre>
</div>

<p>
这里的按键映射不一定按照这个来配置，你可以选择几个比较常用的设置一下。
</p>
</div>
</div>

<div id="outline-container-orgc3399f6" class="outline-2">
<h2 id="orgc3399f6">7. 在 Emacs 中禁用鼠标</h2>
<div class="outline-text-2" id="text-orgc3399f6">
<p>
为什么要在 Emacs 中禁用鼠标？我想对于 Macbook 用户来说，这是很有意义的。
就我来说，我在编辑的时候经常会不经意的碰到触摸板，这就导致我的光标经常会跑到其他地方，然而我要找到我刚才编辑的地方就会很麻烦。虽然这种事情发生的频率不高，但是非常的烦人。
</p>

<p>
另外一点，不用鼠标也有其他的好处。这会强迫我们使用键盘去操作所有的事情，通常这样会更加的快。如果我们习惯了使用键盘操作所有的事情，我相信效率上会提高一大截。
</p>

<p>
设置的代码，我是直接 copy 的<a href="http://endlessparentheses.com/disable-mouse-only-inside-emacs.html">这里</a>。
</p>

<div class="container">
<pre><code class="elisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">define-minor-mode</span> <span class="org-function-name">disable-mouse-mode</span>
  <span class="org-doc">"A minor-mode that disables all mouse keybinds."</span>
  <span class="org-builtin">:global</span> t
  <span class="org-builtin">:lighter</span> <span class="org-string">"Mouse&#128045;"</span>
  <span class="org-builtin">:keymap</span> <span class="org-rainbow-delimiters-depth-2">(</span>make-sparse-keymap<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-2">(</span>type <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-3">(</span>mouse down-mouse drag-mouse
                      double-mouse triple-mouse<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-3">(</span>prefix <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-4">(</span><span class="org-string">""</span> C- M- S- M-S- C-M- C-S- C-M-S-<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">Yes, I actually HAD to go up to 7 here.</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">dotimes</span> <span class="org-rainbow-delimiters-depth-4">(</span>n 7<span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-rainbow-delimiters-depth-6">(</span>k <span class="org-rainbow-delimiters-depth-7">(</span>format <span class="org-string">"%s%s-%s"</span> prefix type n<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
        <span class="org-rainbow-delimiters-depth-5">(</span>define-key disable-mouse-mode-map
          <span class="org-rainbow-delimiters-depth-6">(</span>vector <span class="org-rainbow-delimiters-depth-7">(</span>intern k<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span> <span class="org-highlight-quoted-quote">#'</span><span class="org-highlight-quoted-symbol">ignore</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

</code></pre>
</div>
</div>
</div>

<div id="outline-container-orgee43c5b" class="outline-2">
<h2 id="orgee43c5b">8. 交换 C-w 和 M-w 的命令绑定</h2>
<div class="outline-text-2" id="text-orgee43c5b">
<p>
在编辑的过程中我发现，复制一块区域的次数要多于使用剪切操作。所以交换了这两个按键。
因为 C-w 绑定到了 <code>whole-line-or-region-kill-region</code> 上，而 M-w 到了 <code>whole-line-or-region-kill-ring-save</code>
</p>

<div class="container">
<pre><code class="elisp"><span class="org-rainbow-delimiters-depth-1">(</span>global-set-key <span class="org-rainbow-delimiters-depth-2">(</span>kbd <span class="org-string">"C-w"</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">whole-line-or-region-kill-ring-save</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>global-set-key <span class="org-rainbow-delimiters-depth-2">(</span>kbd <span class="org-string">"M-w"</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">whole-line-or-region-kill-region</span><span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>
</div>
</div>

<div id="outline-container-org6a9e802" class="outline-2">
<h2 id="org6a9e802">9. 截图</h2>
<div class="outline-text-2" id="text-org6a9e802">
<p>
最近在上公开课的时候，经常需要停下来记录一些重点，这就导致效率有些低，所以我想能不能先截图。这样是快了很多，但是对我来说也不方便。
因为我是使用的 Org 来记录的笔记，所以要找到刚才截的图然后插入到 Org 笔记中就不是很方便了，而且图片存放的文件需要手动的建立。所以这些能自动化就好了。
</p>

<p>
我在网上找了一个截图的函数，稍加修改了一下。
</p>

<div class="container">
<pre><code class="elisp"><span class="org-comment-delimiter">;;; </span><span class="org-comment">https://emacs-china.org/t/org-mode/79</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">my-org-screenshot</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-doc">"Take a screenshot into a time stamped unique-named file in the</span>
<span class="org-doc">same directory as the org-buffer and insert a link to this file."</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>org-display-inline-images<span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> filename
        <span class="org-rainbow-delimiters-depth-3">(</span>concat
         <span class="org-rainbow-delimiters-depth-4">(</span>make-temp-name
          <span class="org-rainbow-delimiters-depth-5">(</span>concat <span class="org-rainbow-delimiters-depth-6">(</span>file-name-directory <span class="org-rainbow-delimiters-depth-7">(</span>buffer-file-name<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span>
                  <span class="org-string">"/imgs/"</span>
                  <span class="org-rainbow-delimiters-depth-6">(</span>format-time-string <span class="org-string">"%Y%m%d_%H%M%S_"</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span> <span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-string">".png"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">unless</span> <span class="org-rainbow-delimiters-depth-3">(</span>file-exists-p <span class="org-rainbow-delimiters-depth-4">(</span>file-name-directory filename<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>make-directory <span class="org-rainbow-delimiters-depth-4">(</span>file-name-directory filename<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                                        <span class="org-comment-delimiter">; </span><span class="org-comment">take screenshot</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>eq system-type <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">darwin</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">progn</span>
        <span class="org-rainbow-delimiters-depth-4">(</span>call-process-shell-command <span class="org-string">"screencapture"</span> nil nil nil nil <span class="org-string">" -s "</span> <span class="org-rainbow-delimiters-depth-5">(</span>concat
                                                                            <span class="org-string">"</span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">"</span></span></span><span class="org-string">"</span> filename <span class="org-string">"</span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">"</span></span></span><span class="org-string">"</span> <span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
        <span class="org-rainbow-delimiters-depth-4">(</span>call-process-shell-command <span class="org-string">"convert"</span> nil nil nil nil <span class="org-rainbow-delimiters-depth-5">(</span>concat <span class="org-string">"</span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">"</span></span></span><span class="org-string">"</span> filename <span class="org-string">"</span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">"</span></span></span><span class="org-string"> -resize  </span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">"</span></span></span><span class="org-string">50%</span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">"</span></span></span><span class="org-string">"</span> <span class="org-rainbow-delimiters-depth-5">)</span> <span class="org-rainbow-delimiters-depth-5">(</span>concat <span class="org-string">"</span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">"</span></span></span><span class="org-string">"</span> filename <span class="org-string">"</span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">"</span></span></span><span class="org-string">"</span> <span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
        <span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">setq</span> relative-dir <span class="org-rainbow-delimiters-depth-3">(</span>concat <span class="org-string">"./imgs/"</span> <span class="org-rainbow-delimiters-depth-4">(</span>file-name-nondirectory filename<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>file-exists-p filename<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>insert <span class="org-rainbow-delimiters-depth-4">(</span>concat <span class="org-string">"[[file:"</span> relative-dir <span class="org-string">"]]"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>org-display-inline-images<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgcc510d5" class="outline-2">
<h2 id="orgcc510d5">10. 拖拽图片到 Org mode</h2>
<div class="outline-text-2" id="text-orgcc510d5">
<p>
有时候想把电脑上的图片引入到 Org 中会比较繁琐，所以就想能不能直接拖进来呢？后来找了个函数改了改。
这个函数会把图片 copy 到当前目录的 imgs 子目录下，如果没有 imgs 需要先创建一个。当然，你可以改下面的函数来满足自己的需求。
</p>

<div class="container">
<pre><code class="elisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">drag file to org mode</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">http://kitchingroup.cheme.cmu.edu/blog/2015/07/10/Drag-images-and-files-onto-org-mode-and-insert-a-link-to-them/</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">my-dnd-func</span> <span class="org-rainbow-delimiters-depth-2">(</span>event<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span> <span class="org-string">"e"</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>goto-char <span class="org-rainbow-delimiters-depth-3">(</span>nth 1 <span class="org-rainbow-delimiters-depth-4">(</span>event-start event<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>x-focus-frame nil<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let*</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>payload <span class="org-rainbow-delimiters-depth-5">(</span>car <span class="org-rainbow-delimiters-depth-6">(</span>last event<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>type <span class="org-rainbow-delimiters-depth-5">(</span>car payload<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>fname <span class="org-rainbow-delimiters-depth-5">(</span>cadr payload<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span>img-regexp <span class="org-string">"</span><span class="org-string"><span class="org-regexp-grouping-backslash"><span class="org-hes-escape-backslash">\</span></span></span><span class="org-string"><span class="org-regexp-grouping-backslash"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">\</span></span></span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">png</span><span class="org-string"><span class="org-regexp-grouping-backslash"><span class="org-hes-escape-backslash">\</span></span></span><span class="org-string"><span class="org-regexp-grouping-backslash"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">\</span></span></span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">jp[e]?g</span><span class="org-string"><span class="org-regexp-grouping-backslash"><span class="org-hes-escape-backslash">\</span></span></span><span class="org-string"><span class="org-regexp-grouping-backslash"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">\</span></span></span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">svg</span><span class="org-string"><span class="org-regexp-grouping-backslash"><span class="org-hes-escape-backslash">\</span></span></span><span class="org-string"><span class="org-regexp-grouping-backslash"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">\</span></span></span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">\</span></span></span><span class="org-string">&gt;"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">cond</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">insert image link</span>
     <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-rainbow-delimiters-depth-5">(</span><span class="org-keyword">and</span>  <span class="org-rainbow-delimiters-depth-6">(</span>eq <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">drag-n-drop</span> <span class="org-rainbow-delimiters-depth-7">(</span>car event<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span>
            <span class="org-rainbow-delimiters-depth-6">(</span>eq <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">file</span> type<span class="org-rainbow-delimiters-depth-6">)</span>
            <span class="org-rainbow-delimiters-depth-6">(</span>string-match img-regexp fname<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
      <span class="org-rainbow-delimiters-depth-5">(</span>dired-copy-file fname <span class="org-rainbow-delimiters-depth-6">(</span>format <span class="org-string">"./imgs/%s"</span> <span class="org-rainbow-delimiters-depth-7">(</span>file-name-nondirectory fname<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span> t<span class="org-rainbow-delimiters-depth-5">)</span>
      <span class="org-rainbow-delimiters-depth-5">(</span>insert <span class="org-string">"#+ATTR_HTML: :width 100%</span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">n</span></span></span><span class="org-string">"</span><span class="org-rainbow-delimiters-depth-5">)</span>
      <span class="org-rainbow-delimiters-depth-5">(</span>insert <span class="org-rainbow-delimiters-depth-6">(</span>format <span class="org-string">"[[%s]]"</span> <span class="org-rainbow-delimiters-depth-7">(</span>format <span class="org-string">"./imgs/%s"</span> <span class="org-rainbow-delimiters-depth-8">(</span>file-name-nondirectory fname<span class="org-rainbow-delimiters-depth-8">)</span><span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
      <span class="org-rainbow-delimiters-depth-5">(</span>org-display-inline-images t t<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
     <span class="org-comment-delimiter">;; </span><span class="org-comment">regular drag and drop on file</span>
     <span class="org-rainbow-delimiters-depth-4">(</span>t
      <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-warning">error</span> <span class="org-string">"I am not equipped for dnd on %s"</span> payload<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>
</div>
</div>

<div id="outline-container-orgb59129c" class="outline-2">
<h2 id="orgb59129c">11. Emacs 的键盘宏</h2>
<div class="outline-text-2" id="text-orgb59129c">
<p>
使用键盘宏可以极大的提高我们的效率。我感觉需要单独写一个文章来介绍这个技巧。
这里介绍了如何使用，保存，以及绑定快捷键。具体看<a href="./emacs-macro.html">这里</a>。
</p>
</div>
</div>
<div id="outline-container-orga08fff6" class="outline-2">
<h2 id="orga08fff6">12. new-line-and-indent</h2>
<div class="outline-text-2" id="text-orga08fff6">
<p>
在写代码的时候，我们经常需要自动缩进，而不是回到下一行的开头。这时我们就需要这个函数了，
<b>new-line-and-indent</b> 。我们可以直接使用快捷键 <b>C-j</b> 。也可以绑定到 RETURN 键上。
</p>
<div class="container">
<pre><code class="emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>add-hook <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">lisp-mode-hook</span> <span class="org-highlight-quoted-quote">'</span><span class="org-rainbow-delimiters-depth-2">(</span>lambda <span class="org-rainbow-delimiters-depth-3">()</span>
  <span class="org-rainbow-delimiters-depth-3">(</span>local-set-key <span class="org-rainbow-delimiters-depth-4">(</span>kbd <span class="org-string">"RET"</span><span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">newline-and-indent</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org0e32ef9" class="outline-2">
<h2 id="org0e32ef9">13. Butterfly</h2>
<div class="outline-text-2" id="text-org0e32ef9">
<p>
M-x butterfly
</p>
<div class="container">
<pre><code class="lisp"><span class="org-rainbow-delimiters-depth-1">(</span>animate-string <span class="org-string">"Hello world"</span>
    <span class="org-rainbow-delimiters-depth-2">(</span>/ <span class="org-rainbow-delimiters-depth-3">(</span>window-height<span class="org-rainbow-delimiters-depth-3">)</span> 2<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>- <span class="org-rainbow-delimiters-depth-3">(</span>/ <span class="org-rainbow-delimiters-depth-4">(</span>window-width<span class="org-rainbow-delimiters-depth-4">)</span> 2<span class="org-rainbow-delimiters-depth-3">)</span> 12<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>
</div>
</div>

<div id="outline-container-org02672b0" class="outline-2">
<h2 id="org02672b0">14. 快速生成有序序列</h2>
<div class="outline-text-2" id="text-org02672b0">
<p>
如果我们想生成如下效果的序列：
</p>
<div class="container">
<pre><code class="python">Step 1 of 5: ...
Step 2 of 5: ...
Step 3 of 5: ...
Step 4 of 5: ...
Step 5 of 5: ...
</code></pre>
</div>

<p>
我们就可以借助键盘宏了。
</p>
<ul class="org-ul">
<li><b>C-x C-k C-f</b> 例如 "- Step %d of 5:"</li>
<li>按下 <b>F3</b> 开始宏记录</li>
<li>再次按下 F3 开始插入第一个计数（默认为 0），按下 C-x C-k C-c 可以更改默认值</li>
<li>按 return 键，到下一行</li>
<li>按下 F4 结束宏记录</li>
<li>然后多次按 F4 就可以了</li>
<li>或者按 C-u &lt;次数&gt; F4</li>
</ul>

<p>
根据这个我写了一个函数可以自动做这件事了：
</p>

<div class="container">
<pre><code class="elisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">auto-sequence</span> <span class="org-rainbow-delimiters-depth-2">(</span>format start end<span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span> <span class="org-string">"sSequence format is? </span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">n</span></span></span><span class="org-string">nEnter start number: </span><span class="org-string"><span class="org-hes-escape-backslash">\</span></span><span class="org-string"><span class="org-hes-escape-backslash"><span class="org-hes-escape-sequence">n</span></span></span><span class="org-string">nEnter end number:"</span><span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">progn</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>kmacro-set-format format<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>kmacro-set-counter start<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">while</span> <span class="org-rainbow-delimiters-depth-4">(</span>&lt; start <span class="org-rainbow-delimiters-depth-5">(</span>+ 1 end<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
        <span class="org-rainbow-delimiters-depth-4">(</span>execute-kbd-macro <span class="org-rainbow-delimiters-depth-5">(</span>read-kbd-macro <span class="org-string">"&lt;f3&gt; RET"</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
        <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">setq</span> start <span class="org-rainbow-delimiters-depth-5">(</span>+ 1 start<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>

<p>
我们只需要提供 format, start number, end number 就可以了。
</p>

<p>
最近，又发现了一个文章：<a href="https://zhuanlan.zhihu.com/p/23608879">正则替换也能玩出花来</a>。这里介绍了通过正则替换来做，也很方便。
</p>
</div>
</div>


<div id="outline-container-org751ed96" class="outline-2">
<h2 id="org751ed96">15. C-x r t string-rectangle</h2>
<div class="outline-text-2" id="text-org751ed96">
<p>
这里我们说下 <b>C-x r t</b> 这个命令。举个例子一看就明白了。
</p>
<div class="container">
<pre><code class="python">var <span class="org-variable-name">a</span> = 1
var <span class="org-variable-name">b</span> = 2
var <span class="org-variable-name">c</span> = 3
</code></pre>
</div>
<p>
改成
</p>
<div class="container">
<pre><code class="python"><span class="org-variable-name">this.a</span> = 1
<span class="org-variable-name">this.b</span> = 2
<span class="org-variable-name">this.c</span> = 3
</code></pre>
</div>
<p>
我们就可以用这个命令了。具体的可以看 <a href="http://emacsrocks.com/e01.html">这里</a>。
</p>
</div>
</div>
<div id="outline-container-org2367969" class="outline-2">
<h2 id="org2367969">16. MULTIPLE CURSORS</h2>
<div class="outline-text-2" id="text-org2367969">
<p>
Click <a href="https://github.com/magnars/multiple-cursors.el">this</a>.
</p>

<ul class="org-ul">
<li>第一步，先标记一个 region 否则选择当前位置。</li>
<li>第二步，使用命令 C-&gt; 或者 C-+ 来 mark next like this</li>
</ul>
</div>
</div>
<div id="outline-container-org497a4ce" class="outline-2">
<h2 id="org497a4ce">17. xah math input (<a href="http://ergoemacs.org/emacs/xmsi-math-symbols-input.html">here</a>)</h2>
<div class="outline-text-2" id="text-org497a4ce">
<p>
有了这个我们就可以非常方便的输入一些常用的数学符号，而不是使用 latex 插入。
例如我们输入 字母 p，然后按 S-&lt;SPC&gt; 就转化为了 π。
</p>

<p>
在后来发现在写代码的时候经常会按到这个快捷键，所以我只在 org mode 中打开。
</p>

<div class="container">
<pre><code class="lisp"><span class="org-rainbow-delimiters-depth-1">(</span>add-hook 'org-mode-hook #'xah-math-input-mode-on<span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgb75b417" class="outline-2">
<h2 id="orgb75b417">18. 自动在中英文之间添加空格</h2>
<div class="outline-text-2" id="text-orgb75b417">
<p>
我们可以使用 <a href="https://github.com/coldnew/pangu-spacing">pangu-spacing</a> 这个 package。
</p>
</div>
</div>
<div id="outline-container-org9c2f80d" class="outline-2">
<h2 id="org9c2f80d">19. 禁用特定模式下的快捷键绑定</h2>
<div class="outline-text-2" id="text-org9c2f80d">
<p>
例如，下面这个禁用了 org mode 默认的快捷键绑定，然后使用自己设置的快捷键绑定。
</p>
<div class="container">
<pre><code class="emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>define-key org-mode-map <span class="org-rainbow-delimiters-depth-2">(</span>kbd <span class="org-string">"C-,"</span><span class="org-rainbow-delimiters-depth-2">)</span> nil<span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org9186d74" class="outline-2">
<h2 id="org9186d74">20. &amp;key</h2>
<div class="outline-text-2" id="text-org9186d74">
<div class="container">
<pre><code class="emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun*</span> hello <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-type">&amp;key</span> a b c<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>message <span class="org-rainbow-delimiters-depth-3">(</span>format <span class="org-string">"%s-%s-%s"</span> a b c<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span>hello <span class="org-builtin">:a</span> 1
       <span class="org-builtin">:b</span> 2
       <span class="org-builtin">:c</span> 3<span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>
</div>
</div>
<div id="outline-container-org2676647" class="outline-2">
<h2 id="org2676647">21. Tramp 的使用</h2>
<div class="outline-text-2" id="text-org2676647">
<p>
在 Emacs 通过 tramp 打开远程 server 文件就像打开本地文件一样操纵。
因为 tramp 是 build in package，所以我们可以直接用。
</p>

<ol class="org-ol">
<li>C-x C-f</li>
<li><p>
/ssh:user@server
</p>

<p>
例如 /ssh: ubuntu@10.222.122.11
</p></li>
</ol>

<p>
如果在./ssh/config 中添加了 HOST，例如 test。
</p>
<ol class="org-ol">
<li>C-x C-f</li>
<li>/ssh:test</li>
</ol>
</div>
</div>
<div id="outline-container-org85555d5" class="outline-2">
<h2 id="org85555d5">22. Emacs 中行操作</h2>
<div class="outline-text-2" id="text-org85555d5">
<ul class="org-ul">
<li><a href="https://github.com/emacs-china/emacsist/blob/master/articles/2016-11-07%E4%BD%A0%E8%83%BD%E6%83%B3%E5%88%B0%E7%9A%84%E5%87%A0%E4%B9%8E%E6%89%80%E6%9C%89%E5%85%B3%E4%BA%8E%E8%A1%8C%E7%9A%84%E6%93%8D%E4%BD%9C.org">行操作</a></li>
</ul>
</div>
</div>
<div id="outline-container-org06808d1" class="outline-2">
<h2 id="org06808d1">23. Emacs 模糊打开文件</h2>
<div class="outline-text-2" id="text-org06808d1">
<p>
在之前我一直使用 C-x C-f 打开文件，它默认绑定的是
counsel-find-file。这种方式需要我们一层层的输入目录很慢，所以我希望能有一个比较快的方式。我想到了 projectile 可以做这件事，所以我把
C-x C-f 绑定到了 <b>projectile-find-file-in-known-projects</b> 这个函数上了。
</p>

<p>
这样比如我想打开 ~/workspace/github/hello/world.org 这个文件。 我现在可以在 C-x C-f 后，输入  <b>hello world</b> 。
</p>

<p>
如果我们这样设置的话会遇到一个问题：这个命令非常的慢。这时我们需要将 projectile 的 cache 打开 (<a href="https://github.com/syl20bnr/spacemacs/issues/4207#issuecomment-199951764">reference</a>):
</p>

<div class="container">
<pre><code class="emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">setq</span> projectile-enable-caching t<span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>

<p>
现在就很完美了
</p>
</div>
</div>
<div id="outline-container-org80c5dd3" class="outline-2">
<h2 id="org80c5dd3">24. Emacs Dired mode</h2>
<div class="outline-text-2" id="text-org80c5dd3">
<p>
<a href="https://github.com/emacs-china/emacsist/blob/master/articles/2017-02-20Emacs%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E7%A5%9E%E5%99%A8--dired%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E.org">Emacs 文件管理神器–dired 常用操作说明</a>
</p>
</div>
</div>
<div id="outline-container-orgddbb8f4" class="outline-2">
<h2 id="orgddbb8f4">25. 定义 toggle/cycle command（<a href="http://ergoemacs.org/emacs/elisp_toggle_command.html">参考</a>）</h2>
<div class="outline-text-2" id="text-orgddbb8f4">
<p>
如果我们有两个状态要切换，比较简单：
</p>
<div class="container">
<pre><code class="emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">yd-toggle-move-indent</span> <span class="org-rainbow-delimiters-depth-2">()</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>get <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-toggle-move-indent</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">state</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">progn</span>
          <span class="org-rainbow-delimiters-depth-4">(</span>call-interactively <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">move-beginning-of-line</span><span class="org-rainbow-delimiters-depth-4">)</span>
          <span class="org-rainbow-delimiters-depth-4">(</span>put <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-toggle-move-indent</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">state</span> nil<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">progn</span>
        <span class="org-rainbow-delimiters-depth-4">(</span>call-interactively <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">back-to-indentation</span><span class="org-rainbow-delimiters-depth-4">)</span>
        <span class="org-rainbow-delimiters-depth-4">(</span>put <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-toggle-move-indent</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">state</span> t<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>


<span class="org-rainbow-delimiters-depth-1">(</span>define-key map <span class="org-rainbow-delimiters-depth-2">(</span>kbd <span class="org-string">"C-a"</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-move-indent</span><span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>

<p>
这个例子中实现了通过多次按 C-a 来在当前行的开始位置与非空字符之间切换。
</p>


<p>
但是如果有多个状态呢？这里我们就需要使用数字或字符串来表示状态了。
</p>
<div class="container">
<pre><code class="emacs-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">yd-toggle-test</span> <span class="org-rainbow-delimiters-depth-2">()</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">interactive</span><span class="org-rainbow-delimiters-depth-2">)</span>
    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>not <span class="org-rainbow-delimiters-depth-4">(</span>get <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-toggle-test</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">state</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
        <span class="org-rainbow-delimiters-depth-3">(</span>put <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-toggle-test</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">state</span> <span class="org-string">"beginning"</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>

    <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">cond</span>
     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>string= <span class="org-string">"beginning"</span> <span class="org-rainbow-delimiters-depth-5">(</span>get <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-toggle-test</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">state</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>call-interactively <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">move-beginning-of-line</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>put <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-toggle-test</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">state</span> <span class="org-string">"indentation"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>

     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>string= <span class="org-string">"indentation"</span> <span class="org-rainbow-delimiters-depth-5">(</span>get <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-toggle-test</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">state</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>call-interactively <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">back-to-indentation</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>put <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-toggle-test</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">state</span> <span class="org-string">"end"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>

     <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>string= <span class="org-string">"end"</span> <span class="org-rainbow-delimiters-depth-5">(</span>get <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-toggle-test</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">state</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>call-interactively <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">move-end-of-line</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>put <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">yd-toggle-test</span> <span class="org-highlight-quoted-quote">'</span><span class="org-highlight-quoted-symbol">state</span> <span class="org-string">"beginning"</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
     <span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</code></pre>
</div>

<p>
这个函数用来使光标循环在行的开头，非空字符和结尾位置。
</p>

<p>
另外，它可以在切换 backgroud，单词的大小写（<a href="http://pragmaticemacs.com/emacs/change-case-of-text/">*</a>）等中使用。
我在切换大小写中也使用了 <b>M-c</b> 命令。
</p>
</div>
</div>

<div id="outline-container-org3a40834" class="outline-2">
<h2 id="org3a40834">26. Emacs &#x2013;script</h2>
<div class="outline-text-2" id="text-org3a40834">
<p>
我们可以将一个 elisp 文件作为一个脚本执行。
</p>

<div class="container">
<pre><code class="shell">emacs --script test.el
</code></pre>
</div>
</div>
</div>
<div id="outline-container-orgea87798" class="outline-2">
<h2 id="orgea87798">27. Install and Update packages</h2>
<div class="outline-text-2" id="text-orgea87798">
<p>
Type M-x list-packages to open the package list. Press ‘i’ to mark
for installation, ‘u’ to unmark, and ‘x’ to perform the
installation. Press ‘RET’ to read more about installing and using
each package. hit Uto mark available upgrades, then review to
decide if there are any I don't want to pick up. Then x to
upgrade.
</p>
</div>
</div>
<div id="outline-container-orgf16813a" class="outline-2">
<h2 id="orgf16813a">28. Emacs List 的操作</h2>
<div class="outline-text-2" id="text-orgf16813a">
<ul class="org-ul">
<li><a href="http://ergoemacs.org/emacs/elisp_list.html">http://ergoemacs.org/emacs/elisp_list.html</a></li>
</ul>
</div>
</div>
<div id="outline-container-orgb7747eb" class="outline-2">
<h2 id="orgb7747eb">29. Elisp 代码文件分割线</h2>
<div class="outline-text-2" id="text-orgb7747eb">
<p>
类似的效果如下
</p>

<div class="figure">
<p><img src="./imgs/20171118_220613_6018LKl.png" alt="20171118_220613_6018LKl.png" width="100%" />
</p>
</div>

<p>
我们可以通过在代码中输入<sup>L</sup> 使用命令 C-q C-l。这样可以使得我们的代码清晰一些。
</p>
</div>
</div>
<div id="outline-container-org97b453f" class="outline-2">
<h2 id="org97b453f">30. 使用 Deft 快速的记笔记</h2>
<div class="outline-text-2" id="text-org97b453f">
<p>
最近发现，有些东西不适合展示在 blog 中。例如一些摘抄，记录等等。我的要求是：当我想查的时候能够快速的查询到，而记录的时候又能快速的记录。
Deft 正是一个可以满足我需求的 mode。关于它的使用 github 上有介绍，不多说。
</p>

<p>
这里提下如何高效的利用这个工具，<a href="http://pragmaticemacs.com/category/deft/">Pragmatic Emacs</a> 这里有很好的介绍。
</p>

<p>
另外一个用处是，我可以使用 Deft 来帮助我检索某一个目录。
</p>
</div>
</div>
<div id="outline-container-orgbdeb207" class="outline-2">
<h2 id="orgbdeb207">31. MULTIPLE CHOICES IN YASNIPPETS</h2>
<div class="outline-text-2" id="text-orgbdeb207">
<p>
See this: <a href="http://pragmaticemacs.com/emacs/multiple-choices-in-yasnippets/">http://pragmaticemacs.com/emacs/multiple-choices-in-yasnippets/</a>
</p>
</div>
</div>
<div id="outline-container-org62570da" class="outline-2">
<h2 id="org62570da">32. org-indent-mode</h2>
<div class="outline-text-2" id="text-org62570da">
<p>
在使用 org-mode 的时候，indentation 有时候是很烦人的。使用 org-indent-mode 可以帮助我们做这件事。
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js"></script>

<script>
var base_url = 'https://api.github.com';
var title = document.title;
var owner = 'yydai';
var repo = 'yydai.github.io';
var search_issues = base_url + '/search/issues?q=' + title + '+user:' + owner + '+label:blog'+ '+state:open';

console.log("search_issues = "+ search_issues);

function test() {
  jQuery.ajax({
      type: 'GET',
      async: false,
      dataType:'json',
      url: search_issues,
      success:function(data) {
         result = data;
      }
  });
  return result;
}
var result = test();
var items = result.items[0];
if(jQuery.isEmptyObject(items)) {
    create(title);
} else {
    html_url = items.html_url;
	document.body.innerHTML +=
'<div id="comments"><h2>Comments</h2><div id="header">Want to leave a comment? Visit <a href="'+ html_url + '"> this issue page on GitHub</a> (you will need a GitHub account).</div></div>'
}


function create(title) {
	var create_url = 'https://blog-api-server.herokuapp.com/issues?title=' + title + '&labels=blog&body=Welcome to leave comments here.&owner=yydai&repo=yydai.github.io&auth=eXlkYWk6ZGVpc3Q5MjgxNw=='

	jQuery.ajax({
      type: 'GET',
      async: false,
      dataType:'json',
      url: create_url,
      success:function(data) {
         result = data;
      }
  });
}


console.log("total_count = " + result.total_count);
if(result.total_count == 1) {
    var comments_url = result.items[0].comments_url;
} else if (result.total_count == 0) {
        // create a new issue
    //create(title);
} else {
        // result not only
        alert('Cannot load the comments.');
}

function loadComments(data) {
	repo = 'github.com'
    for (var i=0; i<data.length; i++) {
      var cuser = data[i].user.login;
      var cuserlink = 'https://' + repo + '/' + data[i].user.login;
      var cbody = data[i].body_html;
      var cavatarlink = data[i].user.avatar_url;
      var cdate = Date.parse(data[i].created_at).toString('yyyy-MM-dd HH:mm:ss');

	  var html_url = items.html_url + '#issuecomment-' + data[i].url.substring(data[i].url.lastIndexOf('/')+1);

      var code = '<div class="comment"><div class="commentheader"><div class="commentgravatar">' + '<img src="' + cavatarlink + '" alt="" width="20" height="20">' + '</div><a class="commentuser" href="'+ cuserlink + '">' + cuser + '</a><a class="commentdate" href="' + html_url + '">' + cdate + '</a></div><div class="commentbody">' + cbody + '</div></div>';

      $('#comments').append(code);
    }
  }


var comments_api = comments_url + '?per_page=100';
console.log("comments api: " + comments_api);
$.ajax(comments_api, {
    headers: {Accept: 'application/vnd.github.full+json'},
    dataType: 'json',
    success: function(msg){
      loadComments(msg);
   }
  });


</script>

<hr />
 <div class='footer'>
© 2017 yydai<br/>
Email: dai92817@icloud.com
</div>
</div>
</body>
</html>
